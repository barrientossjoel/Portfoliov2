{"version":3,"sources":["../../src/i18next/resources.ts"],"sourcesContent":["import { existsSync, readFileSync, readdirSync } from \"node:fs\";\nimport { basename, extname, join } from \"node:path\";\nimport type { AstroIntegrationLogger } from \"astro\";\nimport { normalizePath } from \"vite\";\nimport type { Options } from \"../options.js\";\nimport type { I18nextConfig } from \"../types.js\";\n\nexport const getResources = (\n\tlogger: AstroIntegrationLogger,\n\t{ locales }: Options,\n\tlocalesDir: string,\n) => {\n\tconst resources: I18nextConfig[\"resources\"] = {};\n\n\tconst localesDirs = locales\n\t\t.map((locale) => ({\n\t\t\tlocale,\n\t\t\tdir: normalizePath(join(localesDir, locale)),\n\t\t}))\n\t\t.filter((e) => existsSync(e.dir));\n\n\tfor (const { locale, dir } of localesDirs) {\n\t\tconst filenames = readdirSync(dir).filter((f) => f.endsWith(\".json\"));\n\n\t\tfor (const fileName of filenames) {\n\t\t\tconst path = normalizePath(join(dir, fileName));\n\t\t\ttry {\n\t\t\t\tconst content = JSON.parse(readFileSync(path, \"utf-8\"));\n\n\t\t\t\tresources[locale] ??= {};\n\t\t\t\t// biome-ignore lint/style/noNonNullAssertion: fallback is set above\n\t\t\t\tresources[locale]![basename(fileName, extname(fileName))] = content;\n\t\t\t} catch (err) {\n\t\t\t\tlogger.warn(`Can't parse \"${path}\", skipping.`);\n\t\t\t}\n\t\t}\n\t}\n\n\tlogger.info(\n\t\t`${Object.keys(Object.values(resources)).length} resources registered`,\n\t);\n\treturn resources;\n};\n"],"mappings":"AAAA,OAAS,cAAAA,EAAY,gBAAAC,EAAc,eAAAC,MAAmB,UACtD,OAAS,YAAAC,EAAU,WAAAC,EAAS,QAAAC,MAAY,YAExC,OAAS,iBAAAC,MAAqB,OAIvB,IAAMC,EAAe,CAC3BC,EACA,CAAE,QAAAC,CAAQ,EACVC,IACI,CACJ,IAAMC,EAAwC,CAAC,EAEzCC,EAAcH,EAClB,IAAKI,IAAY,CACjB,OAAAA,EACA,IAAKP,EAAcD,EAAKK,EAAYG,CAAM,CAAC,CAC5C,EAAE,EACD,OAAQC,GAAMd,EAAWc,EAAE,GAAG,CAAC,EAEjC,OAAW,CAAE,OAAAD,EAAQ,IAAAE,CAAI,IAAKH,EAAa,CAC1C,IAAMI,EAAYd,EAAYa,CAAG,EAAE,OAAQE,GAAMA,EAAE,SAAS,OAAO,CAAC,EAEpE,QAAWC,KAAYF,EAAW,CACjC,IAAMG,EAAOb,EAAcD,EAAKU,EAAKG,CAAQ,CAAC,EAC9C,GAAI,CACH,IAAME,EAAU,KAAK,MAAMnB,EAAakB,EAAM,OAAO,CAAC,EAEtDR,EAAUE,CAAM,IAAM,CAAC,EAEvBF,EAAUE,CAAM,EAAGV,EAASe,EAAUd,EAAQc,CAAQ,CAAC,CAAC,EAAIE,CAC7D,MAAc,CACbZ,EAAO,KAAK,gBAAgBW,CAAI,cAAc,CAC/C,CACD,CACD,CAEA,OAAAX,EAAO,KACN,GAAG,OAAO,KAAK,OAAO,OAAOG,CAAS,CAAC,EAAE,MAAM,uBAChD,EACOA,CACR","names":["existsSync","readFileSync","readdirSync","basename","extname","join","normalizePath","getResources","logger","locales","localesDir","resources","localesDirs","locale","e","dir","filenames","f","fileName","path","content"]}