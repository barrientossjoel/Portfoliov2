{"version":3,"sources":["../src/content-collections.ts"],"sourcesContent":["type DataEntryConstraint = {\n\tid: string;\n\tcollection: string;\n\tdata: Record<string, unknown>;\n};\ntype ContentEntryConstraint = DataEntryConstraint & { slug: string };\ntype EntryConstraint = DataEntryConstraint | ContentEntryConstraint;\ntype ReferenceConstraint<TEntry extends EntryConstraint> = {\n\tcollection: TEntry[\"collection\"];\n} & (TEntry extends ContentEntryConstraint\n\t? {\n\t\t\tslug: TEntry[\"slug\"];\n\t\t}\n\t: {\n\t\t\tid: TEntry[\"id\"];\n\t\t});\n\ntype PickKeysByValue<T, ValueType> = {\n\t[Key in keyof T as T[Key] extends ValueType ? Key : never]: T[Key];\n};\n\nconst getEntrySlug = (entry: ReferenceConstraint<EntryConstraint>) =>\n\t\"slug\" in entry ? entry.slug : entry.id;\n\nexport const handleI18nSlug = (slug: string) => {\n\tconst segments = slug.split(\"/\");\n\tif (segments.length < 2) {\n\t\tthrow new Error(\n\t\t\t`The slug \"${slug}\" does not match the correct format \"[locale]/[...parts]\"`,\n\t\t);\n\t}\n\tconst [locale, ...parts] = segments;\n\n\treturn {\n\t\tlocale: locale as string,\n\t\tslug: parts.join(\"/\"),\n\t};\n};\n\nexport const collectionFilters = {\n\tbyLocale: <TEntry extends EntryConstraint>(\n\t\tentry: TEntry,\n\t\t{ locale }: { locale: string },\n\t): boolean => {\n\t\tconst slug = getEntrySlug(entry);\n\n\t\treturn handleI18nSlug(slug).locale === locale;\n\t},\n\tmatchingEntries: <\n\t\tTEntry extends EntryConstraint,\n\t\tTKey extends keyof PickKeysByValue<\n\t\t\tTEntry[\"data\"],\n\t\t\tReferenceConstraint<TEntry> | undefined\n\t\t>,\n\t>(\n\t\tentry: TEntry,\n\t\t{\n\t\t\tkey,\n\t\t\tcurrentEntry,\n\t\t\tlocale,\n\t\t\tdefaultLocale,\n\t\t}: {\n\t\t\tcurrentEntry: TEntry;\n\t\t\tkey: TKey;\n\t\t\tlocale: string;\n\t\t\tdefaultLocale: string;\n\t\t},\n\t): boolean => {\n\t\tconst slug = getEntrySlug(entry);\n\t\tconst currentEntrySlug = getEntrySlug(currentEntry);\n\t\tconst reference = entry.data[key] as\n\t\t\t| ReferenceConstraint<TEntry>\n\t\t\t| undefined;\n\n\t\tif (locale === defaultLocale) {\n\t\t\t// Same entry as the current entry\n\t\t\tif (slug === currentEntrySlug) return true;\n\t\t\t// If there's no reference, that means the entry is not linked to the\n\t\t\t// current entry and can be safely ignored\n\t\t\tif (!reference) return false;\n\t\t\t// Wether or not the referenced entry is the current entry\n\t\t\treturn getEntrySlug(reference) === currentEntrySlug;\n\t\t}\n\n\t\tconst currentEntryReference = currentEntry.data[key] as\n\t\t\t| ReferenceConstraint<TEntry>\n\t\t\t| undefined;\n\n\t\t// If the current entry has no reference, it means that is not linked\n\t\t// to any other entries so we can ignore it\n\t\tif (!currentEntryReference) return false;\n\t\t// Same entry as the reference, ie. the default locale entry\n\t\tif (slug === getEntrySlug(currentEntryReference)) return true;\n\t\t// If there's no reference, that means the entry is not linked to the\n\t\t// current entry and can be safely ignored\n\t\tif (!reference) return false;\n\t\t// Wether or not the referenced entry is the same as the default locale entry\n\t\treturn getEntrySlug(reference) === getEntrySlug(currentEntryReference);\n\t},\n};\n"],"mappings":"AAqBA,IAAMA,EAAgBC,GACrB,SAAUA,EAAQA,EAAM,KAAOA,EAAM,GAEzBC,EAAkBC,GAAiB,CAC/C,IAAMC,EAAWD,EAAK,MAAM,GAAG,EAC/B,GAAIC,EAAS,OAAS,EACrB,MAAM,IAAI,MACT,aAAaD,CAAI,2DAClB,EAED,GAAM,CAACE,EAAQ,GAAGC,CAAK,EAAIF,EAE3B,MAAO,CACN,OAAQC,EACR,KAAMC,EAAM,KAAK,GAAG,CACrB,CACD,EAEaC,EAAoB,CAChC,SAAU,CACTN,EACA,CAAE,OAAAI,CAAO,IACI,CACb,IAAMF,EAAOH,EAAaC,CAAK,EAE/B,OAAOC,EAAeC,CAAI,EAAE,SAAWE,CACxC,EACA,gBAAiB,CAOhBJ,EACA,CACC,IAAAO,EACA,aAAAC,EACA,OAAAJ,EACA,cAAAK,CACD,IAMa,CACb,IAAMP,EAAOH,EAAaC,CAAK,EACzBU,EAAmBX,EAAaS,CAAY,EAC5CG,EAAYX,EAAM,KAAKO,CAAG,EAIhC,GAAIH,IAAWK,EAEd,OAAIP,IAASQ,EAAyB,GAGjCC,EAEEZ,EAAaY,CAAS,IAAMD,EAFZ,GAKxB,IAAME,EAAwBJ,EAAa,KAAKD,CAAG,EAMnD,OAAKK,EAEDV,IAASH,EAAaa,CAAqB,EAAU,GAGpDD,EAEEZ,EAAaY,CAAS,IAAMZ,EAAaa,CAAqB,EAF9C,GALY,EAQpC,CACD","names":["getEntrySlug","entry","handleI18nSlug","slug","segments","locale","parts","collectionFilters","key","currentEntry","defaultLocale","currentEntrySlug","reference","currentEntryReference"]}